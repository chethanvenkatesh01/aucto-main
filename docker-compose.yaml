version: '3.8'

services:
  # The Cognitive Engine
  kernel:
    build: ./backend
    container_name: ados_kernel
    ports:
      - "8000:8000"
    volumes:
      # Persist the Ledger and ML Models outside the container
      - ./backend/ados_ledger.db:/app/ados_ledger.db
      - ./backend/model_store.joblib:/app/model_store.joblib
    environment:
      - GEMINI_API_KEY=${GEMINI_API_KEY}
    restart: always

  # The Experience Layer
  cockpit:
    build: 
      context: .
      dockerfile: Dockerfile
    container_name: ados_cockpit
    ports:
      - "3000:80"
    depends_on:
      - kernel
    restart: always